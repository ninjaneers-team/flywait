language: node_js
sudo: required

node_js:
  - "10"
  
services:
  - docker

branches:
  only:
  - master

install:
  - npm install -g semantic-release @semantic-release/release-notes-generator @semantic-release/commit-analyzer @semantic-release/changelog @semantic-release/github @semantic-release/git

before_script:
  - semantic-release
  - git pull
  - export VERSION=$(git describe --tags --abbrev=0 | cut -c 2-)

script:
  - docker build -t ninjaneers/flywait:$VERSION .
  - docker tag ninjaneers/flywait:$VERSION ninjaneers/flywait:latest
  - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
  - docker push ninjaneers/flywait:$VERSION
  - docker push ninjaneers/flywait:latest